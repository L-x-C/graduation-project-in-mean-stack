angular.module("myApp").controller("detailCtrl",function(e,a,o){a.getDetail(o.id).success(function(o){e.data=o,a.trans(e.data);var n,t,r=new BMap.Geocoder,s=e.data.address.city+e.data.address.state+e.data.address.road;r.getPoint(s,function(e){if(e){n=e.lng,t=e.lat;var a={mapType:BMAP_NORMAL_MAP,maxZoom:18,drawMargin:0,enableFulltimeSpotClick:!0,enableHighResolution:!0},o=new BMap.Map("map",a),r=new BMap.Point(n,t);o.centerAndZoom(r,18);var s=new BMap.Marker(r);s.setAnimation(BMAP_ANIMATION_BOUNCE),o.addOverlay(s);var i=new BMap.PanoramaControl;i.setOffset(new BMap.Size(20,20)),o.addControl(i)}})}),e.call="联系房东",e.getPhone=function(){e.call="tel: "+e.data.phone}}),angular.module("myApp").controller("listCtrl",function(e,a){e.more=!1,e.showMore=function(){e.more=!e.more},a.get().success(function(o){e.houseData=o,angular.forEach(e.houseData,function(e){a.trans(e)})})}),angular.module("myApp").controller("indexCtrl",function(e,a,o){e.isLoggedIn=a.isLoggedIn(),e.username=a.isLoggedIn().name,e.logOut=function(){a.logOut()},e.isShow=!1,e.showHowToUse=function(){e.isShow=!e.isShow},e.closeHowToUse=function(){e.isShow=!1},e.search=function(){o.search()}}),angular.module("myApp").controller("navCtrl",function(e,a){e.isLoggedIn=a.isLoggedIn(),e.username=a.isLoggedIn().name,e.logOut=function(){a.logOut()}}),angular.module("myApp").controller("newCtrl",function(e,a,o,n){e.data={houseType:"apartment",roomType:"all",peopleNum:1},e.publishHouse=function(){o.isLoggedIn()?(e.data.userId=o.get(),console.log(e.data),a.publish(e.data)):o.needLogin()},e.data.imgUrl=[],e.uploadInfo="拖动图片至此或单击上传",e.$watch("files",function(){e.upload(e.files)}),e.upload=function(a){if(a&&a.length)for(var o=0;o<a.length;o++){var t=a[o];n.upload({url:"upload/imgs",file:t}).progress(function(a){var o=parseInt(100*a.loaded/a.total);e.uploadInfo=o+"% "}).success(function(a){console.log(a),e.data.imgUrl.push(a.file.path.split("\\").slice(1).join("/"))})}}}),angular.module("myApp").factory("Auth",function(e,a,o){return e.currentUser=o.get("user")||null,{isLoggedIn:function(){return e.currentUser?e.currentUser:!1},logOut:function(){o.remove("user"),location.reload()},needLogin:function(){window.location.href="/#/signin"},get:function(){return e.currentUser._id}}}),angular.module("myApp").factory("House",function(e){return{publish:function(a){e.post("/new",{house:a}).success(function(e){"suc"===e&&(alert("发布成功"),window.location.href="/#/list")})},get:function(){return e.get("/getHouse")},getDetail:function(a){return e.post("/getHouseDetail",{id:a})},search:function(){e.post("/search",{city:"上海市"}).success(function(e){console.log(e)})},trans:function(e){switch(e.houseType){case"apartment":e.houseType="公寓";break;case"independent":e.houseType="独立屋"}switch(e.roomType){case"all":e.roomType="整套房子";break;case"seperate":e.roomType="独立房间";break;case"share":e.roomType="合住房间"}e.realFacilities=[];for(var a in e.facilities)switch(a){case"necessary":e.realFacilities.push("生活必需品");break;case"tv":e.realFacilities.push("电视");break;case"airConditioner":e.realFacilities.push("空调");break;case"heat":e.realFacilities.push("暖气");break;case"kitchen":e.realFacilities.push("厨房");break;case"wifi":e.realFacilities.push("无线网络");break;case"washer":e.realFacilities.push("洗衣机");break;case"bathroom":e.realFacilities.push("浴室")}e.realSpecials=[];for(var o in e.special)switch(o){case"smoking":e.realSpecials.push("允许吸烟");break;case"pets":e.realSpecials.push("允许养宠物");break;case"party":e.realSpecials.push("允许举办派对");break;case"bodyBuilder":e.realSpecials.push("健身房");break;case"fireExtinguisher":e.realSpecials.push("灭火器");break;case"barrierFree":e.realSpecials.push("无障碍设施")}}}});